<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
 * 股票价格信息表（分表）				tab_stock_price
 * 股票ID							stock_id										BIGINT								FOREIGN KEY (fk_stock_price_info)					PRIMARY KEY
 * 日期								stock_price_date								VARCHAR(10)																				PRIMARY KEY
 * 开盘价							stock_price_start_price							DECIMAL(18,2)
 * 收盘价							stock_price_end_price							DECIMAL(18,2)
 * 最高价							stock_price_highest_price						DECIMAL(18,2)
 * 最低价							stock_price_lowest_price						DECIMAL(18,2)
 * 成交量							stock_price_volume								INT(10)
 * 成交额							stock_price_turnover							INT(10)
 * 振幅								stock_price_amplitude							VARCHAR(10)
 * 换手率							stock_price_turnover_rate						DECIMAL(4,1) -->
<mapper namespace="com.hanslv.stock.selector.crawler.repository.TabStockPriceInfoRepository">

	<!-- 插入一个集合 -->
	<insert id="insertList">
		INSERT INTO ${tableName}
		(stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , 
		stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate)
		<foreach collection="priceList" item="priceInfo" open="VALUES" separator=",">
			(#{priceInfo.stockId},#{priceInfo.stockPriceDate},#{priceInfo.stockPriceStartPrice},#{priceInfo.stockPriceEndPrice},
			#{priceInfo.stockPriceHighestPrice},#{priceInfo.stockPriceLowestPrice},#{priceInfo.stockPriceVolume},#{priceInfo.stockPriceTurnover},
			#{priceInfo.stockPriceAmplitude},#{priceInfo.stockPriceTurnoverRate})
		</foreach>
	</insert>
	
	
	
	<!-- 插入一条记录 -->
	<insert id="insertOne">
		INSERT INTO ${tableName}
		(stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , 
		stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate)
		VALUES
		(#{priceInfo.stockId},#{priceInfo.stockPriceDate},#{priceInfo.stockPriceStartPrice},#{priceInfo.stockPriceEndPrice},
		#{priceInfo.stockPriceHighestPrice},#{priceInfo.stockPriceLowestPrice},#{priceInfo.stockPriceVolume},#{priceInfo.stockPriceTurnover},
		#{priceInfo.stockPriceAmplitude},#{priceInfo.stockPriceTurnoverRate})
	</insert>
	
	
	<!-- 获取一只股票在指定日期后指定条数的全部信息 -->
	<select id="selectByStockIdAndAfterDateLimit" parameterType="com.hanslv.stock.selector.commons.dto.TabStockPriceInfo" resultType="com.hanslv.stock.selector.commons.dto.TabStockPriceInfo">
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0001 WHERE stock_id = #{priceInfo.stockId} AND stock_price_date &gt;= #{priceInfo.stockPriceDate} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0002 WHERE stock_id = #{priceInfo.stockId} AND stock_price_date &gt;= #{priceInfo.stockPriceDate} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0003 WHERE stock_id = #{priceInfo.stockId} AND stock_price_date &gt;= #{priceInfo.stockPriceDate} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0001 WHERE stock_id = #{priceInfo.stockId} AND stock_price_date &gt;= #{priceInfo.stockPriceDate} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0002 WHERE stock_id = #{priceInfo.stockId} AND stock_price_date &gt;= #{priceInfo.stockPriceDate} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0003 WHERE stock_id = #{priceInfo.stockId} AND stock_price_date &gt;= #{priceInfo.stockPriceDate} 
		ORDER BY stock_price_date ASC
		LIMIT ${limit}
	</select>
	
	<!-- 获取指定日期后的全部指定股票信息数量 -->
	<select id="selectPriceInfoCountByStockIdAndAfterDate" resultType="java.lang.String">
		SELECT SUM(unionTable.count_stock_id)
		FROM(
		SELECT COUNT(stock_id) AS count_stock_id
		FROM tab_stock_price_shangzheng_0001 WHERE stock_id = #{stockId} AND stock_price_date &gt;= #{dayCondition}
		UNION
		SELECT COUNT(stock_id) AS count_stock_id
		FROM tab_stock_price_shangzheng_0002 WHERE stock_id = #{stockId} AND stock_price_date &gt;= #{dayCondition}
		UNION
		SELECT COUNT(stock_id) AS count_stock_id
		FROM tab_stock_price_shangzheng_0003 WHERE stock_id = #{stockId} AND stock_price_date &gt;= #{dayCondition}
		UNION
		SELECT COUNT(stock_id) AS count_stock_id
		FROM tab_stock_price_shenzheng_0001 WHERE stock_id = #{stockId} AND stock_price_date &gt;= #{dayCondition}
		UNION
		SELECT COUNT(stock_id) AS count_stock_id
		FROM tab_stock_price_shenzheng_0002 WHERE stock_id = #{stockId} AND stock_price_date &gt;= #{dayCondition}
		UNION
		SELECT COUNT(stock_id) AS count_stock_id
		FROM tab_stock_price_shenzheng_0003 WHERE stock_id = #{stockId} AND stock_price_date &gt;= #{dayCondition}
		) unionTable
	</select>
	
	
	<!-- 获取指定日期后的全部指定股票信息 -->
	<select id="selectPriceInfoByStockIdAndLimit" resultType="com.hanslv.stock.selector.commons.dto.TabStockPriceInfo">
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0001 WHERE stock_id = #{stockId}
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0002 WHERE stock_id = #{stockId}
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0003 WHERE stock_id = #{stockId}
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0001 WHERE stock_id = #{stockId}
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0002 WHERE stock_id = #{stockId}
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0003 WHERE stock_id = #{stockId}
		ORDER BY stock_price_date ASC
		LIMIT ${limit}
	</select>
	
	<!-- 获取指定股票在指定日期前（包括）的全部价格信息 -->
	<select id="selectPriceInfoByStockIdAndBeforeDate" resultType="com.hanslv.stock.selector.commons.dto.TabStockPriceInfo">
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0001 WHERE stock_id = #{stockId} AND stock_price_date &lt;= #{date} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0002 WHERE stock_id = #{stockId} AND stock_price_date &lt;= #{date} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shangzheng_0003 WHERE stock_id = #{stockId} AND stock_price_date &lt;= #{date} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0001 WHERE stock_id = #{stockId} AND stock_price_date &lt;= #{date} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0002 WHERE stock_id = #{stockId} AND stock_price_date &lt;= #{date} 
		UNION
		SELECT stock_id , stock_price_date , stock_price_start_price , stock_price_end_price , stock_price_highest_price , stock_price_lowest_price , stock_price_volume , stock_price_turnover , stock_price_amplitude , stock_price_turnover_rate 
		FROM tab_stock_price_shenzheng_0003 WHERE stock_id = #{stockId} AND stock_price_date &lt;= #{date} 
		ORDER BY stock_price_date ASC
	</select>
</mapper>